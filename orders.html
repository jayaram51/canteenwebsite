<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Order Verification - Smart Canteen</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  /* --- GLOBAL --- */
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #141E30, #243B55);
    min-height: 100vh;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 25px;
  }

  /* --- HEADER --- */
  h2 {
    text-align: center;
    font-size: clamp(2rem, 6vw, 3rem);
    font-weight: 700;
    color:  #fff;
    text-shadow: 0 0 10px #00e5ff, 0 0 20px #00e5ff;
    margin-bottom: 20px;
  }

  /* --- CLEAR BUTTON --- */
  #clearOrders {
    display: block;
    width: 220px;
    margin: 0 auto 30px auto;
    padding: 14px 0;
    border: none;
    border-radius: 50px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    background: linear-gradient(135deg, #ff416c, #ff4b2b);
    color: #fff;
    box-shadow: 0 5px 20px rgba(255, 65, 108, 0.5);
    transition: transform 0.3s, box-shadow 0.3s;
  }
  #clearOrders:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(255, 65, 108, 0.7);
  }

  /* --- ORDERS GRID --- */
  #orders {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    width: 100%;
    max-width: 1200px;
  }

  /* --- ORDER CARD --- */
  .order-card {
    background: rgba(255,255,255,0.08);
    padding: 20px;
    border-radius: 20px;
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 0 8px 25px rgba(0,0,0,0.4);
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .order-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(0,229,255,0.5);
  }

  .order-card p {
    font-size: 1rem;
    margin: 6px 0;
  }

  .status {
    font-weight: bold;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    display: inline-block;
    margin-top: 8px;
  }
  .pending { background: #fbc531; color: #2f3640; }
  .verified { background: #4cd137; color: #fff; }

  button.verify-btn {
    display: block;
    width: 100%;
    margin-top: 15px;
    padding: 12px 0;
    border: none;
    border-radius: 50px;
    font-size: 16px;
    cursor: pointer;
    font-weight: bold;
    background: linear-gradient(135deg, #00c6ff, #0072ff);
    color: #fff;
    box-shadow: 0 5px 15px rgba(0,198,255,0.5);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  button.verify-btn:disabled {
    background: #dcdde1;
    cursor: not-allowed;
    color: #7f8fa6;
    box-shadow: none;
  }
  button.verify-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,198,255,0.7);
  }

  /* --- RESPONSIVE --- */
  @media(max-width:480px){
    #clearOrders{width:100%;padding:15px 0;}
    .order-card{padding:18px;}
  }
</style>
</head>
<body>
  <h2>Pending Orders</h2>
  <button id="clearOrders">Clear All Orders</button>
  <div id="orders"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
  import { getDatabase, ref, onValue, update, push, remove } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCeLj-v5Coav6llAeDP30bKn4-k-OzpcQM",
    authDomain: "loginpage-536d9.firebaseapp.com",
    projectId: "loginpage-536d9",
    storageBucket: "loginpage-536d9.appspot.com",
    messagingSenderId: "445956902411",
    appId: "1:445956902411:web:b4d31d65a212f3fc46c10e",
    measurementId: "G-2QELSP6EJ0",
    databaseURL: "https://loginpage-536d9-default-rtdb.firebaseio.com/"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const ordersDiv = document.getElementById("orders");
  const ordersRef = ref(db, "orders");
  const clearBtn = document.getElementById("clearOrders");

  onValue(ordersRef, (snapshot) => {
    ordersDiv.innerHTML = "";
    if (!snapshot.exists()) {
      ordersDiv.innerHTML = "<p style='text-align:center; color:#a4b0be;'>No orders found.</p>";
      return;
    }

    snapshot.forEach(child => {
      const order = child.val();
      const key = child.key;
      const isCompleted = order.completed === true;

      const div = document.createElement("div");
      div.className = "order-card";
      div.innerHTML = `
        <p><b>Food:</b> ${order.food}</p>
        <p><b>Quantity:</b> ${order.qty}</p>
        <p><b>Total:</b> ₹${order.total}</p>
        <span class="status ${isCompleted ? 'verified' : 'pending'}">${isCompleted ? 'Verified ✅' : 'Pending ❌'}</span>
      `;

      const btn = document.createElement("button");
      btn.className = "verify-btn";
      btn.innerText = isCompleted ? "Verified ✅" : "Verify Payment";
      btn.disabled = isCompleted;

      btn.onclick = () => {
        update(ref(db, "orders/" + key), { completed: true });
        push(ref(db, "finalOrders"), {
          food: order.food,
          quantity: order.qty,
          cost: order.total
        }).then(() => {
          alert("Order verified and sent to final page!");
          window.location.href = "finalpage.html";
        });
      };

      div.appendChild(btn);
      ordersDiv.appendChild(div);
    });
  }, (error) => {
    console.error("The read failed:", error);
    ordersDiv.innerHTML = "<p style='color:red; text-align:center;'>Failed to load orders.</p>";
  });

  clearBtn.onclick = () => {
    if (confirm("Are you sure you want to clear all orders? This cannot be undone.")) {
      remove(ordersRef)
        .then(() => {
          alert("All orders cleared!");
          ordersDiv.innerHTML = "<p style='text-align:center; color:#a4b0be;'>No orders found.</p>";
        })
        .catch((error) => {
          console.error("Error clearing orders:", error);
          alert("Failed to clear orders.");
        });
    }
  };
</script>
</body>
</html>
